# Исправления системы управления предметами

## Выполненные изменения (09.10.2025)

### 1. ✅ Множественный выбор игр при редактировании предметов

**Проблема:** При редактировании существующих предметов можно было выбрать только одну игру.

**Решение:**
- Обновлена страница `Edit.vue` - заменен одиночный select на множественный выбор с чекбоксами
- Форма теперь правильно инициализируется с массивом `games` из данных предмета
- Добавлена валидация - требуется выбрать хотя бы одну игру

### 2. ✅ Исправлено отображение "БЕЗ ИГРЫ"

**Проблема:** Новые предметы с выбранными играми показывали тег "БЕЗ ИГРЫ" в списке админки.

**Решение:**
- Обновлен контроллер `GameItemController::index()` - теперь добавляет атрибут `available_games` к каждому предмету
- Обновлена страница `Index.vue` - теперь отображает список игр из `available_games` через запятую
- Если игры не указаны, тогда показывается "БЕЗ ИГРЫ"

### 3. ✅ Возможность создавать предметы с одинаковым названием

**Проблема:** Нельзя было создать предмет с таким же названием (например, "Speed Cola") для разных игр из-за уникального ограничения на slug.

**Решение:**
- Создана миграция `2025_10_09_160000_remove_unique_constraint_from_slug.php` - убирает уникальное ограничение на поле `slug`
- Обновлена модель `GameItem` - добавлена автоматическая генерация уникальных slug с добавлением счетчика при совпадении
- Теперь можно создать несколько предметов с одинаковым названием, система автоматически создаст slug вида: `speed-cola`, `speed-cola-2`, `speed-cola-3` и т.д.
- Каждый предмет может иметь свою картинку и описание

## Примеры использования

### Создание предмета для нескольких игр

1. Откройте "Создание предмета"
2. Введите название: "Быстрокола (Speed-cola)"
3. Выберите тип: "Перк"
4. Выберите игры: Black Ops, Black Ops 2, Black Ops 3 (можно выбрать несколько)
5. Загрузите картинку
6. Сохраните

### Создание вариаций предмета для разных игр

Теперь вы можете создать несколько версий одного предмета:

1. **Speed Cola (Black Ops 3)** - с картинкой из BO3
2. **Speed Cola (Cold War)** - с другой картинкой из CW
3. **Speed Cola (Black Ops 6)** - с картинкой из BO6

Каждый предмет будет иметь уникальный slug (`speed-cola`, `speed-cola-2`, `speed-cola-3`).

### Редактирование существующих предметов

1. Откройте предмет для редактирования
2. Выберите одну или несколько игр с помощью чекбоксов
3. Сохраните изменения

## Технические детали

### Автоматическая генерация slug

Модель `GameItem` теперь автоматически генерирует уникальный slug:
- При создании: `boot()` → `creating` event
- При обновлении (если изменилось имя): `boot()` → `updating` event
- Метод `generateUniqueSlug()` проверяет существование slug и добавляет счетчик при необходимости

### Поддержка обратной совместимости

Система поддерживает как старое поле `game` (одиночное), так и новое `games` (массив):
- Метод `getAvailableGamesAttribute()` объединяет данные из обоих полей
- Scope `forGame()` ищет по обоим полям
- Метод `isAvailableInGame()` проверяет оба поля

### API и фильтрация

- API endpoint `/api/game-items` возвращает предметы с атрибутом `available_games`
- Фильтрация по игре работает корректно с множественными играми
- GuideItemSelector показывает все игры предмета

## Файлы, которые были изменены

1. `app/Models/GameItem.php` - добавлены методы для работы с множественными играми и автогенерация slug
2. `app/Http/Controllers/GameItemController.php` - обновлены методы store, update, index, apiList
3. `resources/js/Pages/Admin/Items/Create.vue` - множественный выбор игр
4. `resources/js/Pages/Admin/Items/Edit.vue` - множественный выбор игр
5. `resources/js/Pages/Admin/Items/Index.vue` - отображение списка игр
6. `resources/js/Components/GuideItemSelector.vue` - отображение множественных игр
7. `database/migrations/2025_10_09_130000_migrate_game_to_games_array.php` - миграция данных
8. `database/migrations/2025_10_09_160000_remove_unique_constraint_from_slug.php` - снятие ограничения

## Результат

✅ Можно выбирать несколько игр при создании/редактировании предмета
✅ Корректно отображаются все игры в списке админки
✅ Можно создавать предметы с одинаковым названием для разных игр
✅ Каждый предмет может иметь свою уникальную картинку
✅ Фильтрация по играм работает корректно
✅ Все существующие предметы продолжают работать без проблем

