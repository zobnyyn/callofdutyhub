# Фильтрация предметов по играм в гайдах

## Что было сделано

Добавлена фильтрация **всех типов предметов** (оружие, перки и жвачки) по играм при создании и редактировании гайдов. Теперь при выборе любых предметов для гайда пользователь видит только те предметы, которые относятся к выбранной игре.

## Изменённые файлы

### 1. GuideItemSelector.vue
**Путь:** `/resources/js/Components/GuideItemSelector.vue`

**Изменения:**
- Добавлен новый пропс `selectedGame` для получения выбранной игры
- В функции `loadItems()` добавлена фильтрация по игре для **всех типов предметов** (weapon, perk, gum)
- Добавлена проверка при открытии модального окна - для всех типов предметов требуется выбрать игру
- Добавлен `watch` на `selectedGame` для автоматической перезагрузки списка при смене игры
- Добавлено отображение названия игры в карточках предметов
- Добавлено предупреждение, если игра не выбрана при попытке добавить любой предмет

### 2. GameItemController.php
**Путь:** `/app/Http/Controllers/GameItemController.php`

**Изменения:**
- В методе `apiList()` добавлена фильтрация по параметру `game`
- API поддерживает запросы с фильтром по игре для всех типов предметов

### 3. Create.vue (Создание гайда)
**Путь:** `/resources/js/Pages/Admin/Guides/Create.vue`

**Изменения:**
- В компонент `GuideItemSelector` для **всех типов** предметов добавлен пропс `:selectedGame="form.game"`
- Все компоненты получают информацию о выбранной игре из формы гайда

### 4. Edit.vue (Редактирование гайда)
**Путь:** `/resources/js/Pages/Admin/Guides/Edit.vue`

**Изменения:**
- В компонент `GuideItemSelector` для **всех типов** предметов добавлен пропс `:selectedGame="form.game"`
- Все компоненты получают информацию о выбранной игре из формы гайда

## Как это работает

1. **При создании нового гайда:**
   - Пользователь выбирает игру в поле "GAME"
   - При попытке добавить любой предмет (оружие, перк или жвачку), система автоматически фильтрует список только по предметам этой игры
   - Если игра не выбрана, система показывает предупреждение

2. **При редактировании существующего гайда:**
   - Игра уже выбрана из сохранённых данных гайда
   - Списки всех типов предметов автоматически фильтруются по этой игре
   - При смене игры списки предметов автоматически обновляются

3. **Пользовательский опыт:**
   - Под всеми кнопками добавления предметов показывается подсказка, если игра не выбрана
   - В модальном окне выбора в заголовке отображается название игры
   - В карточках выбранных предметов отображается название игры

## API

### Endpoint
```
GET /api/game-items
```

### Параметры
- `type` (string) - тип предмета: weapon, perk, gum
- `game` (string, optional) - название игры для фильтрации
- `search` (string, optional) - поиск по названию

### Примеры запросов
```
GET /api/game-items?type=weapon&game=Black Ops 3
GET /api/game-items?type=perk&game=Cold War
GET /api/game-items?type=gum&game=Black Ops 4
```

## Технические детали

- Фильтрация применяется ко **всем типам предметов**: оружие (weapon), перки (perk) и жвачки (gum)
- При смене игры в форме гайда автоматически перезагружаются списки всех типов предметов
- Выбранные предметы сохраняются даже при смене игры (но могут быть не совместимы с новой игрой)

## Важное замечание о данных

⚠️ **Обратите внимание:** Для всех типов предметов в базе данных поле `game` может быть пустым для существующих записей. Необходимо:
1. Заполнить поле `game` для всех существующих предметов в базе данных
2. При создании новых предметов обязательно указывать игру

### Обновление существующих предметов

Выполните следующие действия для каждого предмета:
1. Зайдите в админ-панель управления предметами: `/admin/items`
2. Отфильтруйте по типу (weapon/perk/gum)
3. Отредактируйте каждый предмет и выберите соответствующую игру в поле "GAME"
4. Сохраните изменения

## Тестирование

Для тестирования функциональности:

1. Перейдите на страницу создания гайда: `/admin/guides/create`
2. Попробуйте добавить любой предмет без выбора игры - должно появиться предупреждение
3. Выберите игру (например, "Black Ops 3")
4. Добавьте оружие - должно отображаться только оружие из Black Ops 3
5. Добавьте перк - должны отображаться только перки из Black Ops 3
6. Добавьте жвачку - должны отображаться только жвачки из Black Ops 3
7. Смените игру - списки всех доступных предметов должны обновиться

## История изменений

- **10 октября 2025** - Первоначальная реализация для жвачек
- **10 октября 2025** - Добавлена фильтрация для перков
- **10 октября 2025** - Добавлена фильтрация для оружия (полная реализация для всех типов предметов)
