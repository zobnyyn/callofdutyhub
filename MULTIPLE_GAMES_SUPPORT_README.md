# Поддержка множественных игр для предметов

## Обзор изменений

Теперь каждый предмет (оружие, перк, жвачка) может быть привязан к нескольким играм одновременно. Это особенно полезно для предметов, которые присутствуют в нескольких частях Call of Duty.

## Изменения в базе данных

### Новое поле `games`
- **Тип**: JSON массив
- **Описание**: Содержит список игр, в которых доступен предмет
- **Пример**: `["Black Ops 3", "Black Ops 4", "Cold War"]`

### Старое поле `game`
- Сохранено для обратной совместимости
- Автоматически мигрировано в поле `games`

## Изменения в модели GameItem

### Новые методы:

#### `scopeForGame($query, $game)`
Фильтрует предметы по игре с учетом обоих полей (game и games):
```php
GameItem::forGame('Black Ops 3')->get();
```

#### `isAvailableInGame($game)`
Проверяет, доступен ли предмет в указанной игре:
```php
$item->isAvailableInGame('Black Ops 3'); // true/false
```

#### `getAvailableGamesAttribute()`
Возвращает массив всех игр, в которых доступен предмет:
```php
$item->available_games; // ['Black Ops 3', 'Cold War']
```

## Изменения в контроллере

### GameItemController::store()
- Теперь принимает массив `games` вместо одиночного значения `game`
- Валидация требует выбора хотя бы одной игры

### GameItemController::update()
- Поддерживает обновление массива игр
- Поле `game` теперь `nullable`

### GameItemController::apiList()
- Фильтрация работает с множественными играми через `forGame` scope
- Возвращает атрибут `available_games` для каждого предмета

## Изменения в интерфейсе администратора

### Страница создания/редактирования предмета
- Заменен одиночный select на множественный выбор с чекбоксами
- Можно выбрать одну или несколько игр
- Визуальная индикация выбранных игр

### GuideItemSelector компонент
- Отображает список всех игр для каждого предмета
- Фильтрация учитывает множественную принадлежность к играм

## Примеры использования

### Создание предмета для нескольких игр
```php
GameItem::create([
    'name' => 'Juggernog',
    'type' => 'perk',
    'games' => ['Black Ops', 'Black Ops 2', 'Black Ops 3', 'Black Ops 4'],
    // ...
]);
```

### Получение всех предметов для конкретной игры
```php
$items = GameItem::forGame('Black Ops 3')->get();
```

### Проверка доступности предмета
```php
$rayGun = GameItem::where('name', 'Ray Gun')->first();
if ($rayGun->isAvailableInGame('Cold War')) {
    // Предмет доступен в Cold War
}
```

## Миграция данных

Миграция `2025_10_09_130000_migrate_game_to_games_array.php` автоматически переносит данные из поля `game` в `games`. Все существующие предметы сохраняют свою игровую привязку.

## Обратная совместимость

- Старое поле `game` сохранено в базе данных
- API поддерживает оба варианта фильтрации
- Существующие гайды продолжают работать без изменений

## Будущие улучшения

- [ ] Массовое редактирование игр для нескольких предметов
- [ ] Фильтр по нескольким играм одновременно в админке
- [ ] Статистика по распределению предметов по играм
- [ ] Возможность копировать предметы между играми

